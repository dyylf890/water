layui.define(["icheck","laypage","layer","form","laydate","laytpl"],function(e){var t=layui.jquery,n=layui.laypage,a=layui.form(),i=layui.laytpl,r=layui.layer,o=window.layer;var c=function(){this.config={queryForm:"#query-form",queryTrigger:"#query-trigger",addForm:"#add-form",addTrigger:"#add-trigger",updateForm:"#update-form",updateTrigger:".update-trigger",detailForm:"#detail-form",detailTrigger:".detail-trigger",deleteTrigger:"#delete-trigger",importTrigger:"#import-trigger",exportTrigger:"#export-trigger"};this.saveTitle='<i class="fa fa-save"></i> 保存';this.backTitle='<i class="fa fa-reply"></i> 返回';this.pageIndex=0;this.loadIndex=0;this.initFlag=true;this.init()};c.fn=c.prototype;c.fn.init=function(){var e=this;e.bindEvents();e.events();e.ready();e.toPage(1)};c.fn.bindEvents=function(){var e=this;t(document).on("click",e.config.queryTrigger,function(){e.query();return false});t(document).on("click",e.config.addTrigger,function(){e.toAdd({template:t(this).attr("template"),title:t(this).html()});return false});t(document).on("click",e.config.updateTrigger,function(){e.toUpdate({url:t(this).attr("data-href"),template:t(this).attr("template"),title:t(this).html()});return false});t(document).on("click",e.config.detailTrigger,function(){e.toDetail({url:t(this).attr("data-href"),template:t(this).attr("template"),title:t(this).html()});return false});t(document).on("click",e.config.deleteTrigger,function(){e.delete({url:t(this).attr("data-href"),name:t(this).attr("data-name")});return false});t(document).on("click",e.config.importTrigger,function(){e.import();return false});t(document).on("click",e.config.exportTrigger,function(){e.export();return false});t(document).on("ifChanged","#selected-all",function(e){var n=t("#selected-all").prop("checked");var a=t(".layui-table tbody tr td").find("input");a.iCheck(e.currentTarget.checked?"check":"uncheck")});t(document).on("ifChecked",".layui-table tbody tr input",function(e){t(this).parents("tr").addClass("layui-table-tr-checked")});t(document).on("ifUnchecked",".layui-table tbody tr input",function(e){t(this).parents("tr").removeClass("layui-table-tr-checked")});t(document).on("click",".layui-table tbody tr",function(e){var n=t(this);var a=n.children("td").eq(0).find("input");a.iCheck("toggle")});t(window).on("resize",function(){e.pageIndex>0&&r.full(e.pageIndex)})};c.fn.render=function(){a.render();t("input").iCheck({checkboxClass:"icheckbox_flat-grey"})};c.fn.query=function(){var e=this;e.get(t(e.config.queryForm).attr("action"),t(e.config.queryForm).serialize(),function(n){var a=t("#table-template").html();i(a).render(n,function(n){t("table>tbody").html(n);e.render()});if(e.initFlag){e.intPager(n.pager);e.initFlag=false}})};c.fn.toPage=function(e){var n=this;t(n.config.queryForm).find("input[name=pageNumber]").val(e);t(n.config.queryTrigger).trigger("click")};c.fn.intPager=function(e){var t=this;n({cont:"pager",pages:e.pageTotal,groups:5,jump:function(e,n){if(!n){t.toPage(e.curr)}}})};c.fn.openPage=function(e){var n=this;i(t(e.template).html()).render(e.data,function(t){n.pageIndex=r.open({id:"page-content",type:1,title:e.title,content:t,btnAlign:"l",btn:[n.saveTitle,n.backTitle],yes:e.callback,end:function(){n.pageIndex=0}});a.render();r.full(n.pageIndex)})};c.fn.addTimestamp=function(e){var t=(new Date).getTime();e+="?timestamp="+t;return e};c.fn.toAdd=function(e){var t=this;e.callback=function(){t.add()};e.data={};t.openPage(e)};c.fn.add=function(){var e=this;var n=t(e.config.addForm);e.post(n.attr("action"),n.serialize(),function(t){r.msg(t.message);r.close(e.pageIndex);e.initFlag=true;e.query()})};c.fn.toUpdate=function(e){var t=this;e.callback=function(){t.update()};if(e.url&&e.url!=""){t.get(e.url,null,function(n){e.data=n.result;t.openPage(e)})}else{r.msg("数据链接地址不能为空")}};c.fn.update=function(){var e=this;var n=t(e.config.updateForm);e.post(n.attr("action"),n.serialize(),function(t){r.msg(t.message);r.close(e.pageIndex);e.query()})};c.fn.toDetail=function(e){var t=this;e.callback=function(){};if(e.url&&e.url!=""){t.get(e.url,null,function(n){e.data=n.result;t.openPage(e)})}else{r.msg("数据链接地址不能为空")}};c.fn.delete=function(e){var t=this;var n=t.getValuesByInputName("ids",".layui-table tbody");if(n.ids.length<1){r.msg("请选择要删除数据");return false}o.confirm("确认删除："+n.names+" ？",{icon:7},function(){t.get(e.url,{ids:n.ids.join(",")},function(e){r.msg(e.message);t.query()})})};c.fn.getValuesByInputName=function(e,n){var a=this;var i={ids:[],names:[]};t("input:checkbox[name="+e+"]:checked:not(disabled)",n||document).each(function(e,n){i.ids.push(t(n).val());i.names.push(t(n).attr("data-name"))});return i};c.fn.import=function(){r.msg("执行导入操作")};c.fn.export=function(){r.msg("执行导出操作")};c.fn.ajax=function(e){var n=this;e=e||{};e.timestamp=(new Date).getTime();t.ajax({url:e.url,type:e.type,data:e.data,dataType:"json",cache:false,success:e.callback,error:function(){r.close(n.loadIndex);r.msg("请求失败",{icon:2})},beforeSend:function(){n.loadIndex=r.load(1)},complete:function(){r.close(n.loadIndex)}})};c.fn.get=function(e,t,n){var a=this;a.ajax({url:e,type:"GET",data:t,callback:n})};c.fn.post=function(e,t,n){var a=this;a.ajax({url:e,type:"POST",data:t,callback:n})};c.fn.ready=function(){};c.fn.events=function(){};e("base",c)});